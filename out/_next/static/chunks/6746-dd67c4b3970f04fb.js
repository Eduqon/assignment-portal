"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6746],{6746:function(e,n,t){t.r(n);var r=t(8520),s=t.n(r),i=t(5893),c=t(9736),a=t(2028),o=t(8790),l=t(4612),d=t(5193),u=t(9042),h=t(7375),x=t(4090),p=t(9669),f=t.n(p),g=t(7294),j=t(1163),m=t(6257),b=t(8754),T=t(7388);function w(e,n,t,r,s,i,c){try{var a=e[i](c),o=a.value}catch(l){return void t(l)}a.done?n(o):Promise.resolve(o).then(r,s)}function v(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var i=e.apply(n,t);function c(e){w(i,r,s,c,a,"next",e)}function a(e){w(i,r,s,c,a,"throw",e)}c(void 0)}))}}function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function k(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){y(e,n,t[n])}))}return e}function C(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.default=function(e){var n=e.confirmOrderAssignedExpertMessages,t=e.operatorExpertChat,r=function(){return(0,i.jsxs)(a.u_,{size:"lg",onClose:H.onClose,isOpen:H.isOpen,onOpen:H.onOpen,isCentered:!0,children:[(0,i.jsx)(a.ZA,{}),(0,i.jsxs)(a.hz,{maxH:"500px",children:[(0,i.jsx)(a.ol,{}),(0,i.jsx)(a.fe,{children:(0,i.jsxs)(o.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"md",children:[(0,i.jsx)(o.xu,{p:4,bgColor:"gray.200",children:(0,i.jsx)(o.Ug,{children:(0,i.jsx)(o.X6,{fontSize:"xl",children:"Operator Chat with Expert"})})}),(0,i.jsxs)(o.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"sm",maxH:"sm",children:[(0,i.jsx)(o.gC,{overflowY:"scroll",alignItems:"start",width:"100%",children:D&&t&&t[D.id]&&t[D.id].map((function(e,n){return(0,i.jsx)(o.xu,{display:"TEXT"===e.type||"MEDIA"===e.type?"flex":"none",alignSelf:e.user===z?"flex-end":"flex-start",flexWrap:!0,padding:2,borderRadius:"md",maxWidth:"70%",bgColor:e.user===z?"blue.100":"green.100",children:(0,i.jsxs)(o.gC,{maxWidth:"100%",overflowWrap:"break-word",children:[(0,i.jsx)(o.xv,{display:"TEXT"===e.type?"flex":"none",maxWidth:"100%",children:e.msg}),(0,i.jsx)(o.rU,{color:"blue",fontWeight:"bold",display:"MEDIA"===e.type?"flex":"none",maxWidth:"100%",href:e.msg,children:e.msg&&e.msg.substring(62)})]})},n)}))}),(0,i.jsxs)(l.BZ,{children:[(0,i.jsx)(l.II,{type:"text",id:"addChatOperatorExpert"}),(0,i.jsx)(l.II,{type:"file",id:"addFileOperatorExpert",onChange:v(s().mark((function e(){var n,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",P){U();try{t={method:"put",url:"https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(P.current.files[0].name)+"?"+q,headers:{"x-ms-blob-type":"BlockBlob"},data:P.current.files[0]},f()(t).then(function(e){var t=v(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(P.current.files[0].name),e.next=3,(0,m.r7)((0,m.JU)(T.db,"chat",D.chat[D.chat.length-1].user+"_"+z+"_"+D.id),{conversation:(0,m.vr)({msg:n,time:Date.now(),type:"MEDIA",user:z})});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return t.apply(this,arguments)}}()).catch((function(e){console.log(e)}))}catch(r){console.log(r)}B()}case 2:case"end":return e.stop()}}),e)}))),ref:P,style:{display:"none"}}),(0,i.jsx)(l.Z8,{h:"full",children:(0,i.jsx)(d.zx,{id:"attachButton",onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P.current.click();case 1:case"end":return e.stop()}}),e)}))),children:(0,i.jsx)(c.Uj,{})})}),(0,i.jsx)(l.xH,{h:"full",children:(0,i.jsx)(d.zx,{id:"sendButton",onClick:v(s().mark((function e(){var n,t,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=localStorage.getItem("userToken"),t=/\b[\+]?[(]?[0-9]{2,6}[)]?[-\s\.]?[-\s\/\.0-9]{3,15}\b/m,""===(r=document.getElementById("addChatOperatorExpert")).value||void 0===r.value){e.next=23;break}if(!t.test(r.value)){e.next=8;break}window.alert("Sharing Phone Numbers through Chat is not allowed"),e.next=23;break;case 8:return e.next=10,(0,m.r7)((0,m.JU)(T.db,"chat",D.chat[D.chat.length-1].user+"_"+z+"_"+D.id),{conversation:(0,m.vr)({msg:r.value,time:Date.now(),type:"TEXT",user:z})});case 10:return e.sent,i={headers:{Authorization:"Bearer ".concat(n)}},e.prev=12,e.next=15,f().post(b.JW+"/messages",{id:D.id,expertEmail:D.chat[D.chat.length-1].user},i);case 15:c=e.sent,c.data.success&&(r.value=""),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(12),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[12,20]])}))),children:(0,i.jsx)(c.mr,{})})})]})]})]})})]})]})},p=function(){var e;return y&&0!==y.length&&n&&0!==n.length&&I&&(e=n.filter((function(e){return y[I].id===e.id}))),(0,i.jsxs)(a.u_,{size:"4xl",onClose:J.onClose,isOpen:J.isOpen,onOpen:J.onOpen,isCentered:!0,children:[(0,i.jsx)(a.ZA,{}),(0,i.jsxs)(a.hz,{children:[(0,i.jsx)(a.xB,{children:"Messages"}),(0,i.jsx)(a.ol,{}),(0,i.jsx)(a.fe,{children:(0,i.jsxs)(u.iA,{variant:"simple",size:"sm",children:[(0,i.jsx)(u.hr,{bgColor:"gray.200",children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Id"}),(0,i.jsx)(u.Th,{children:"Expert Email"}),(0,i.jsx)(u.Th,{children:"Messages"}),(0,i.jsx)(u.Th,{})]})}),(0,i.jsx)(u.p3,{children:e&&0===e.length?(0,i.jsx)(i.Fragment,{}):e&&e.map((function(e,n){return(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Td,{children:e.id}),(0,i.jsx)(u.Td,{children:e.chat[e.chat.length-1].user}),(0,i.jsx)(u.Td,{children:e.chat[e.chat.length-1].msg}),(0,i.jsx)(u.Td,{children:(0,i.jsx)(o.Ug,{children:(0,i.jsx)(d.zx,{onClick:v(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,G(e);case 2:$(e.id);case 3:case"end":return n.stop()}}),n)}))),children:"Reply"})})})]},e.id)}))})]})})]})]})},w=(0,g.useState)([]),y=w[0],S=w[1],O=(0,g.useState)(),I=O[0],A=O[1],E=(0,g.useState)([]),D=E[0],_=E[1],W=(0,g.useState)(""),z=W[0],R=W[1],P=(0,g.useRef)(null),Q=(0,h.qY)(),U=Q.onOpen,B=Q.onClose,M=(0,g.useState)(""),q=M[0],F=M[1],J=(0,h.qY)(),H=(0,h.qY)(),N=[],X=(0,j.useRouter)();function L(){return Y.apply(this,arguments)}function Y(){return(Y=v(s().mark((function e(){var n,t,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==(n=localStorage.getItem("userToken"))&&X.replace("/admin/login"),t={headers:{Authorization:"Bearer ".concat(n)}},e.next=6,f().get(b.JW+"/assignment/fetch?status=Proof%20Read",t);case 6:if(r=e.sent,i=r.data.assignmentData,N=[],0!==i.length)for(c=0;c<i.length;c++)N.push({id:i[c]._id,client_id:i[c].client_id,assignedQC:i[c].assignedQC,subject:i[c].subject,status:i[c].status,quotation:i[c].quotation,currencyOfQuote:i[c].currencyOfQuote,level:i[c].level,reference:i[c].reference,description:i[c].description,descriptionFile:i[c].descriptionFile,numOfPages:i[c].numOfPages,paid:i[c].paid,deadline:new Date(i[c].deadline).toLocaleTimeString()+", "+new Date(i[c].deadline).toDateString(),expertDeadline:new Date(i[c].expertDeadline).toLocaleTimeString()+", "+new Date(i[c].expertDeadline).toDateString()});else console.log("No Proof Read Orders");S(N),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function Z(){return K.apply(this,arguments)}function K(){return(K=v(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("userEmail"),R(n),e.prev=2,e.next=5,f().get(b.JW+"/util/sas-token?container_name=assignment-dscp");case 5:t=e.sent,(r=t.data).success&&F(r.SASToken),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function G(e){return V.apply(this,arguments)}function V(){return(V=v(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{null==localStorage.getItem("userToken")&&X.replace("/admin/login")}catch(t){console.log(t)}_(n),H.onOpen();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return ee.apply(this,arguments)}function ee(){return(ee=v(s().mark((function e(n){var r,i,c,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==(r=localStorage.getItem("userToken"))&&X.replace("/admin/login"),{headers:{Authorization:"Bearer ".concat(r)}},!t[n]){e.next=11;break}return i=t[n].slice(),c=i.pop(),a=localStorage.getItem("userEmail"),e.next=10,(0,m.r7)((0,m.JU)(T.db,"chat",c.user+"_"+a+"_"+n),{conversation:C(i).concat([k({},c,{newMessageCount:0})])});case 10:e.sent;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function ne(e){return te.apply(this,arguments)}function te(){return(te=v(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(n),J.onOpen();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,g.useEffect)((function(){v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z();case 2:case"end":return e.stop()}}),e)})))()}),[]),(0,g.useEffect)((function(){L()}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p,{}),(0,i.jsx)(r,{}),(0,i.jsxs)(u.iA,{variant:"simple",size:"md",display:{base:"none",sm:"block",md:"block"},children:[(0,i.jsx)(u.hr,{bgColor:"gray.200",children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Id"}),(0,i.jsx)(u.Th,{children:"Student Email"}),(0,i.jsx)(u.Th,{children:"Subject"}),(0,i.jsx)(u.Th,{children:"Order Quote"}),(0,i.jsx)(u.Th,{children:"Amount Paid"}),(0,i.jsx)(u.Th,{children:"Expert Deadline"}),(0,i.jsx)(u.Th,{children:"Deadline"}),(0,i.jsx)(u.Th,{children:"Assigned QC"}),(0,i.jsx)(u.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(c.ny,{}),onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})]})}),(0,i.jsx)(u.p3,{children:y.map((function(e,t){return(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Td,{fontWeight:"semibold",paddingTop:9,children:(0,i.jsxs)(o.xu,{display:"flex",children:[(0,i.jsx)(o.rU,{href:"/admin/assignment_details/"+e.id,children:e.id}),n&&0!==n.length&&n.map((function(n){if(n.id===e.id&&n.chat&&0!==n.chat.length&&0!==n.chat[n.chat.length-1].newMessageCount)return(0,i.jsxs)(o.xu,{display:"flex",alignItems:"center",position:"relative",marginLeft:2,cursor:"pointer",onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ne(t));case 1:case"end":return e.stop()}}),e)}))),children:[(0,i.jsx)(c.kB,{width:"1.5em",height:"1.5em"}),(0,i.jsx)(o.xu,{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:15,backgroundColor:"rgb(201, 105, 105)",marginLeft:2,width:5,height:5,color:"white",position:"absolute",right:"-10px",top:"-5px",children:n.chat&&n.chat[n.chat.length-1].newMessageCount})]})}))]})}),(0,i.jsx)(u.Td,{children:"Super Admin"===localStorage.getItem("userRole")||"Admin"===localStorage.getItem("userRole")?e.client_id:e.client_id.substring(0,2)+"****@****.com"}),(0,i.jsx)(u.Td,{color:"green.600",fontWeight:"semibold",children:e.subject}),(0,i.jsx)(u.Td,{children:e.quotation}),(0,i.jsx)(u.Td,{children:e.paid}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline}),(0,i.jsx)(u.Td,{children:e.assignedQC})]},e.id)}))})]}),(0,i.jsx)("div",{className:"ShowSideClick",children:y.map((function(e){return(0,i.jsx)(x.UQ,{defaultIndex:[0],allowMultiple:!0,display:{base:"block",sm:"none",md:"none"},children:(0,i.jsxs)(x.Qd,{children:[(0,i.jsx)("h2",{children:(0,i.jsxs)(x.KF,{children:[(0,i.jsx)(o.xu,{flex:"1",textAlign:"left",children:(0,i.jsx)(u.iA,{children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Id"}),(0,i.jsx)(u.Td,{fontWeight:"semibold",children:(0,i.jsx)(o.rU,{href:"/admin/assignment_details/"+e.id,children:e.id})})]})})}),(0,i.jsx)(x.XE,{})]})}),(0,i.jsx)(x.Hk,{pb:0,children:(0,i.jsx)(u.iA,{variant:"simple",size:"md",children:(0,i.jsx)(u.p3,{children:(0,i.jsx)(u.Tr,{children:(0,i.jsxs)(u.iA,{bgColor:"gray.100",children:[(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Student Email"}),(0,i.jsx)(u.Td,{children:"Super Admin"===localStorage.getItem("userRole")||"Admin"===localStorage.getItem("userRole")?e.client_id:e.client_id.substring(0,2)+"****@****.com"})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Subject"}),(0,i.jsx)(u.Td,{color:"green.600",fontWeight:"semibold",children:e.subject})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Order Quote"}),(0,i.jsx)(u.Td,{children:e.quotation})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Amount Paid"}),(0,i.jsx)(u.Td,{children:e.paid})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Expert Deadline"}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Deadline"}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Assigned QC"}),(0,i.jsx)(u.Td,{children:e.assignedQC})]}),(0,i.jsx)(u.Tr,{children:(0,i.jsx)(u.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(c.ny,{}),onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})})]})},e.id)})})})]})})}))})]})}}}]);