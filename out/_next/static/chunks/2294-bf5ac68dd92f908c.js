"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2294],{2294:function(e,n,r){r.r(n);var t=r(8520),s=r.n(t),i=r(5893),a=r(9736),c=r(2028),o=r(9762),l=r(4612),d=r(5193),u=r(3441),x=r(9042),p=r(8790),h=r(7375),m=r(4090),f=r(9669),j=r.n(f),g=r(7294),k=r(8756),w=r(1163);function v(e,n,r,t,s,i,a){try{var c=e[i](a),o=c.value}catch(l){return void r(l)}c.done?n(o):Promise.resolve(o).then(t,s)}function b(e){return function(){var n=this,r=arguments;return new Promise((function(t,s){var i=e.apply(n,r);function a(e){v(i,t,s,a,c,"next",e)}function c(e){v(i,t,s,a,c,"throw",e)}a(void 0)}))}}n.default=function(e){var n=e.incrementCounter,r=e.decrementCounter,t=function(){return(0,i.jsxs)(c.u_,{size:"2xl",onClose:ne.onClose,isOpen:ne.isOpen,onOpen:ne.onOpen,isCentered:!0,children:[(0,i.jsx)(c.ZA,{}),(0,i.jsxs)(c.hz,{children:[(0,i.jsx)(c.xB,{children:"Rework Request"}),(0,i.jsx)(c.ol,{}),(0,i.jsxs)(c.fe,{children:[(0,i.jsxs)(o.NI,{id:"file",children:[(0,i.jsx)(o.lX,{children:"1) Upload File"}),(0,i.jsxs)(l.BZ,{children:[(0,i.jsx)(l.II,{type:"text",isReadOnly:!0,value:W}),(0,i.jsxs)(l.xW,{children:[(0,i.jsx)(d.zx,{onClick:function(){return _.current.click()},children:(0,i.jsx)(a.Uj,{})}),(0,i.jsx)("input",{type:"file",onChange:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q(_.current.files[0].name),e.next=3,ae(_.current.files[0].name,_.current.files[0]);case 3:case"end":return e.stop()}}),e)}))),ref:_,style:{display:"none"}})]})]})]}),(0,i.jsxs)(l.BZ,{flexDirection:"column",children:[(0,i.jsx)(o.lX,{children:"2) Add Comments For Experts"}),(0,i.jsx)(u.g,{id:"qcComment"})]})]}),(0,i.jsx)(c.mz,{children:(0,i.jsx)(d.zx,{onClick:function(){L?window.alert("File is still being uploaded"):function(e){ee.apply(this,arguments)}(z)},children:"Send"})})]})]})},f=function(){return(0,i.jsxs)(c.u_,{size:"2xl",onClose:oe.onClose,isOpen:oe.isOpen,onOpen:oe.onOpen,isCentered:!0,children:[(0,i.jsx)(c.ZA,{}),(0,i.jsxs)(c.hz,{children:[(0,i.jsx)(c.xB,{children:"Submissions"}),(0,i.jsx)(c.ol,{}),(0,i.jsx)(c.fe,{children:(0,i.jsxs)(x.iA,{variant:"simple",size:"sm",children:[(0,i.jsx)(x.hr,{bgColor:"gray.200",children:(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"File"}),(0,i.jsx)(x.Th,{children:"Category"}),(0,i.jsx)(x.Th,{children:"Date"}),(0,i.jsx)(x.Th,{children:"Delivery"}),(0,i.jsx)(x.Th,{children:"Expert ID"})]})}),(0,i.jsx)(x.p3,{children:0===I.length?(0,i.jsx)(i.Fragment,{}):I.map((function(e,n){return(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Td,{maxW:"100px",children:(0,i.jsx)(p.rU,{isExternal:!0,href:e.url,children:e.name})}),(0,i.jsx)(x.Td,{children:e.category}),(0,i.jsx)(x.Td,{children:e.createdAt}),(0,i.jsx)(x.Td,{color:new Date(e.createdAtNF)-new Date(T[z].expertDeadlineNF)<=0?"green":"red",children:new Date(e.createdAtNF)-new Date(T[z].expertDeadlineNF)<=0?"On Time":"Late"}),(0,i.jsx)(x.Td,{children:e.expertId})]},e._id)}))})]})})]})]})},v=(0,g.useState)([]),T=v[0],C=v[1],y=(0,g.useState)([]),I=y[0],S=y[1],A=(0,g.useState)(),z=A[0],D=A[1],E=(0,g.useState)(""),R=E[0],O=E[1],_=(0,g.useRef)(null),F=(0,g.useState)(""),W=F[0],Q=F[1],B=(0,g.useState)(""),J=B[0],N=B[1],U=(0,h.qY)(),P=U.isOpen,q=(U.onOpen,U.onClose),Z=(0,g.useState)(!1),L=Z[0],M=Z[1],X=[],Y=[],H=(0,w.useRouter)();function K(e){return G.apply(this,arguments)}function G(){return(G=b(s().mark((function e(n){var r,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=localStorage.getItem("userToken"),t={headers:{Authorization:"Bearer ".concat(r)}},e.next=5,j().post(k.JW+"/expert/remove/ask",{assignmentId:T[n].id},t);case 5:e.sent,window.alert("Operator asked for approval to remove expert"),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function V(e){return $.apply(this,arguments)}function $(){return($=b(s().mark((function e(t){var i,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=localStorage.getItem("userToken"),a=localStorage.getItem("userEmail"),c={headers:{Authorization:"Bearer ".concat(i)}},e.next=6,j().post(k.JW+"/assignment/update",{_id:T[t].id,status:"Proof Read",assignedQC:a},c);case 6:return e.sent,e.next=9,j().post(k.JW+"/notifications",{assignmentId:T[t].id,status:"Proof Read",read:!1},c);case 9:e.sent,n("Proof Read"),r("Internal Rework"),ue(),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(0);case 17:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function ee(){return(ee=b(s().mark((function e(r){var t,i,a,c,o,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("qcComment"),i=localStorage.getItem("userEmail"),a=localStorage.getItem("userName"),""!==t.value){e.next=7;break}window.alert("Add a comment"),e.next=51;break;case 7:if(""!==J){e.next=29;break}return e.prev=8,c=localStorage.getItem("userToken"),o={headers:{Authorization:"Bearer ".concat(c)}},e.next=13,j().post(k.JW+"/assignment/update",{_id:T[r].id,status:"Internal Rework",assignedQC:i},o);case 13:return e.sent,e.next=16,j().post(k.JW+"/notifications",{assignmentId:T[z].id,status:"Internal Rework",read:!1},o);case 16:return e.sent,n("Internal Rework"),e.next=20,j().post(k.JW+"/assignment/comments/QCToExpert",{assignmentId:T[r].id,expertId:T[r].assignedExpert,commentsFromQC:{_id:i,name:a,comment:t.value}},o);case 20:e.sent,ue(),ne.onClose(),e.next=27;break;case 25:e.prev=25,e.t0=e.catch(8);case 27:e.next=51;break;case 29:return e.prev=29,l=localStorage.getItem("userToken"),d={headers:{Authorization:"Bearer ".concat(l)}},e.next=34,j().post(k.JW+"/assignment/update",{_id:T[r].id,status:"Internal Rework",assignedQC:i},d);case 34:return e.sent,e.next=37,j().post(k.JW+"/notifications",{assignmentId:T[z].id,status:"Internal Rework",read:!1},d);case 37:return e.sent,n("Internal Rework"),e.next=41,j().post(k.JW+"/assignment/comments/QCToExpert",{assignmentId:T[r].id,expertId:T[r].assignedExpert,commentsFromQC:{_id:i,name:a,comment:J}},d);case 41:return e.sent,e.next=44,j().post(k.JW+"/assignment/comments/QCToExpert",{assignmentId:T[r].id,expertId:T[r].assignedExpert,commentsFromQC:{_id:i,name:a,comment:t.value}},d);case 44:e.sent,ue(),ne.onClose(),e.next=51;break;case 49:e.prev=49,e.t1=e.catch(29);case 51:case"end":return e.stop()}}),e,null,[[8,25],[29,49]])})))).apply(this,arguments)}var ne=(0,h.qY)();function re(e){return te.apply(this,arguments)}function te(){return(te=b(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(n),Q(""),N(""),ne.onOpen();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return ie.apply(this,arguments)}function ie(){return(ie=b(s().mark((function e(){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j().get(k.JW+"/util/sas-token?container_name=assignment-dscp");case 3:n=e.sent,(r=n.data).success&&O(r.SASToken),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function ae(e,n){return ce.apply(this,arguments)}function ce(){return(ce=b(s().mark((function e(n,r){var t,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(!0),t=r,i={method:"put",url:"https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(n)+"?"+R,headers:{"x-ms-blob-type":"BlockBlob"},data:t},j()(i).then((function(e){N("https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(n)),M(!1)})).catch((function(e){console.log(e),M(!1)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=(0,h.qY)();function le(e){return de.apply(this,arguments)}function de(){return(de=b(s().mark((function e(n){var r,t,i,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(n),e.prev=1,null==(r=localStorage.getItem("userToken"))&&H.replace("/admin/login"),t={headers:{Authorization:"Bearer ".concat(r)}},e.next=7,j().get(k.JW+"/assignment/submissions/fetch?assignment_id="+T[n].id,t);case 7:return i=e.sent,e.next=10,i.data.result.workSubmissions;case 10:if(a=e.sent,Y=[],0!==a.length)for(c=0;c<a.length;c++)Y.push({_id:a[c]._id,name:a[c].name,url:a[c].url,category:a[c].category,createdAt:a[c].createdAt,createdAtNF:a[c].createdAt,expertId:a[c].expertId});else window.alert("No Submissions Found");S(Y),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0);case 19:oe.onOpen();case 20:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function ue(){return xe.apply(this,arguments)}function xe(){return(xe=b(s().mark((function e(){var n,r,t,i,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==(n=localStorage.getItem("userToken"))&&H.replace("/admin/login"),r={headers:{Authorization:"Bearer ".concat(n)}},e.next=6,j().get(k.JW+"/assignment/fetch?status=Internal%20Rework",r);case 6:if(t=e.sent,i=t.data.assignmentData,X=[],0===i.length){e.next=15;break}for(a=0;a<i.length;a++)X.push({id:i[a]._id,assignedExpert:i[a].assignedExpert,assignedQC:i[a].assignedQC,client_id:i[a].client_id,subject:i[a].subject,status:i[a].status,quotation:i[a].quotation,currencyOfQuote:i[a].currencyOfQuote,level:i[a].level,reference:i[a].reference,description:i[a].description,descriptionFile:i[a].descriptionFile,numOfPages:i[a].numOfPages,paid:i[a].paid,deadline:new Date(i[a].deadline).toLocaleTimeString()+", "+new Date(i[a].deadline).toDateString(),expertDeadline:new Date(i[a].expertDeadline).toLocaleTimeString()+", "+new Date(i[a].expertDeadline).toDateString(),expertDeadlineNF:i[a].expertDeadline});return e.next=13,se();case 13:e.next=16;break;case 15:console.log("No Raw Submission Orders");case 16:C(X),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}return(0,g.useEffect)((function(){ue()}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{display:{base:"none",sm:"block",md:"block"},children:[(0,i.jsxs)(c.u_,{closeOnOverlayClick:!1,isOpen:P,onClose:q,children:[(0,i.jsx)(c.ZA,{}),(0,i.jsxs)(c.hz,{children:[(0,i.jsx)(c.xB,{children:"File Upload"}),(0,i.jsx)(c.ol,{}),(0,i.jsx)(c.fe,{pb:6,children:"File is being uploaded, please wait.."})]})]}),(0,i.jsx)(t,{}),(0,i.jsx)(f,{}),(0,i.jsxs)(x.iA,{variant:"simple",size:"md",display:{base:"none",sm:"block",md:"block"},children:[(0,i.jsx)(x.hr,{bgColor:"gray.200",children:(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Id"}),(0,i.jsx)(x.Th,{children:"Subject"}),(0,i.jsx)(x.Th,{children:"Deadline"}),(0,i.jsx)(x.Th,{children:"Expert Deadline"}),(0,i.jsx)(x.Th,{children:"Assigned Expert"}),(0,i.jsx)(x.Th,{children:"Assigned QC"}),(0,i.jsx)(x.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(a.ny,{}),onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})]})}),(0,i.jsx)(x.p3,{children:T.map((function(e,n){return(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Td,{fontWeight:"semibold",children:(0,i.jsx)(p.rU,{href:"/admin/assignment_details/"+e.id,children:e.id})}),(0,i.jsx)(x.Td,{color:"green.600",fontWeight:"semibold",children:e.subject}),(0,i.jsx)(x.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline}),(0,i.jsx)(x.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline}),(0,i.jsx)(x.Td,{children:e.assignedExpert}),(0,i.jsx)(x.Td,{children:e.assignedQC}),(0,i.jsx)(x.Td,{children:(0,i.jsxs)(p.Ug,{children:[(0,i.jsx)(d.zx,{onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",le(n));case 1:case"end":return e.stop()}}),e)}))),children:"Submissions from Experts"}),(0,i.jsx)(d.zx,{onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",V(n));case 1:case"end":return e.stop()}}),e)}))),children:"Mark as Proof Read"}),(0,i.jsx)(d.zx,{color:"red",onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re(n));case 1:case"end":return e.stop()}}),e)}))),children:"Send for Rework"}),(0,i.jsx)(d.zx,{color:"red",onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(n));case 1:case"end":return e.stop()}}),e)}))),children:"Remove Expert"})]})})]},e.id)}))})]})]}),(0,i.jsx)("div",{className:"ShowSideClick",children:T.map((function(e,n){return(0,i.jsx)(m.UQ,{defaultIndex:[0],allowMultiple:!0,display:{base:"block",sm:"none",md:"none"},children:(0,i.jsxs)(m.Qd,{children:[(0,i.jsx)("h2",{children:(0,i.jsxs)(m.KF,{children:[(0,i.jsx)(p.xu,{flex:"1",textAlign:"left",children:"internal Rework Orders"}),(0,i.jsx)(m.XE,{})]})}),(0,i.jsxs)(m.Hk,{pb:4,children:[(0,i.jsxs)(c.u_,{closeOnOverlayClick:!1,isOpen:P,onClose:q,children:[(0,i.jsx)(c.ZA,{}),(0,i.jsxs)(c.hz,{children:[(0,i.jsx)(c.xB,{children:"File Upload"}),(0,i.jsx)(c.ol,{}),(0,i.jsx)(c.fe,{pb:6,children:"File is being uploaded, please wait.."})]})]}),(0,i.jsx)(t,{}),(0,i.jsx)(f,{}),(0,i.jsx)(x.iA,{variant:"simple",size:"md",children:(0,i.jsx)(x.p3,{children:(0,i.jsx)(x.Tr,{children:(0,i.jsxs)(x.iA,{bgColor:"gray.200",children:[(0,i.jsx)(x.Tr,{children:(0,i.jsx)(x.Td,{fontWeight:"semibold",children:(0,i.jsx)(p.rU,{href:"/admin/assignment_details/"+e.id,children:e.id})})}),(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Subject"}),(0,i.jsx)(x.Td,{color:"green.600",fontWeight:"semibold",children:e.subject})]}),(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Deadline"}),(0,i.jsx)(x.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline})]}),(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Expert Deadline"}),(0,i.jsx)(x.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline})]}),(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Assigned Expert"}),(0,i.jsx)(x.Td,{children:e.assignedExpert})]}),(0,i.jsxs)(x.Tr,{children:[(0,i.jsx)(x.Th,{children:"Assigned QC"}),(0,i.jsx)(x.Td,{children:e.assignedQC})]}),(0,i.jsx)(x.Tr,{children:(0,i.jsx)(x.Td,{children:(0,i.jsxs)(p.Ug,{children:[(0,i.jsx)(d.zx,{onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",le(n));case 1:case"end":return e.stop()}}),e)}))),children:"Submissions from Experts"}),(0,i.jsx)(d.zx,{onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",V(n));case 1:case"end":return e.stop()}}),e)}))),children:"Mark as Proof Read"}),(0,i.jsx)(d.zx,{color:"red",onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re(n));case 1:case"end":return e.stop()}}),e)}))),children:"Send for Rework"}),(0,i.jsx)(d.zx,{color:"red",onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(n));case 1:case"end":return e.stop()}}),e)}))),children:"Remove Expert"})]})})}),(0,i.jsx)(x.Tr,{children:(0,i.jsx)(x.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(a.ny,{}),onClick:b(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})})]})},e.id)})})]})]})})}))})]})}}}]);