"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2445],{2445:function(e,n,t){t.r(n);var r=t(8520),s=t.n(r),i=t(5893),c=t(9736),o=t(2028),a=t(8790),l=t(4612),d=t(5193),u=t(9042),h=t(7375),p=t(9669),x=t.n(p),f=t(7294),m=t(8754),g=t(1163),j=t(4090),b=t(6257),w=t(7388);function v(e,n,t,r,s,i,c){try{var o=e[i](c),a=o.value}catch(l){return void t(l)}o.done?n(a):Promise.resolve(a).then(r,s)}function y(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var i=e.apply(n,t);function c(e){v(i,r,s,c,o,"next",e)}function o(e){v(i,r,s,c,o,"throw",e)}c(void 0)}))}}function T(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function k(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){T(e,n,t[n])}))}return e}function C(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.default=function(e){e.inProcessOrderAssignedExpertMessages;var n,t=e.operatorExpertChat,r=e.inProcessOrderData,p=function(){return(0,i.jsxs)(o.u_,{size:"lg",onClose:N.onClose,isOpen:N.isOpen,onOpen:N.onOpen,isCentered:!0,children:[(0,i.jsx)(o.ZA,{}),(0,i.jsxs)(o.hz,{maxH:"500px",children:[(0,i.jsx)(o.ol,{}),(0,i.jsx)(o.fe,{children:(0,i.jsxs)(a.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"md",children:[(0,i.jsx)(a.xu,{p:4,bgColor:"gray.200",children:(0,i.jsx)(a.Ug,{children:(0,i.jsx)(a.X6,{fontSize:"xl",children:"Operator Chat with Expert"})})}),(0,i.jsxs)(a.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"sm",maxH:"sm",children:[(0,i.jsx)(a.gC,{overflowY:"scroll",alignItems:"start",width:"100%",children:D&&t[D]&&t[D].map((function(e,n){return(0,i.jsx)(a.xu,{display:"TEXT"===e.type||"MEDIA"===e.type?"flex":"none",alignSelf:e.user===R?"flex-end":"flex-start",flexWrap:!0,padding:2,borderRadius:"md",maxWidth:"70%",bgColor:e.user===R?"blue.100":"green.100",children:(0,i.jsxs)(a.gC,{maxWidth:"100%",overflowWrap:"break-word",children:[(0,i.jsx)(a.xv,{display:"TEXT"===e.type?"flex":"none",maxWidth:"100%",children:e.msg}),(0,i.jsx)(a.rU,{color:"blue",fontWeight:"bold",display:"MEDIA"===e.type?"flex":"none",maxWidth:"100%",href:e.msg,children:e.msg&&e.msg.substring(62)})]})},n)}))}),(0,i.jsxs)(l.BZ,{children:[(0,i.jsx)(l.II,{type:"text",id:"addChatOperatorExpert"}),(0,i.jsx)(l.II,{type:"file",id:"addFileOperatorExpert",onChange:y(s().mark((function e(){var n,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",F){X();try{t={method:"put",url:"https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(F.current.files[0].name)+"?"+U,headers:{"x-ms-blob-type":"BlockBlob"},data:F.current.files[0]},x()(t).then(function(e){var t=y(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(F.current.files[0].name),e.next=3,(0,b.r7)((0,b.JU)(w.db,"chat",D.split("_")[1]+"_"+R+"_"+D.split("_")[0]),{conversation:(0,b.vr)({msg:n,time:Date.now(),type:"MEDIA",user:R})});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return t.apply(this,arguments)}}()).catch((function(e){console.log(e)}))}catch(r){console.log(r)}q()}case 2:case"end":return e.stop()}}),e)}))),ref:F,style:{display:"none"}}),(0,i.jsx)(l.Z8,{h:"full",children:(0,i.jsx)(d.zx,{id:"attachButton",onClick:y(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:F.current.click();case 1:case"end":return e.stop()}}),e)}))),children:(0,i.jsx)(c.Uj,{})})}),(0,i.jsx)(l.xH,{h:"full",children:(0,i.jsx)(d.zx,{id:"sendButton",onClick:y(s().mark((function e(){var n,t,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=localStorage.getItem("userToken"),t=/\b[\+]?[(]?[0-9]{2,6}[)]?[-\s\.]?[-\s\/\.0-9]{3,15}\b/m,""===(r=document.getElementById("addChatOperatorExpert")).value||void 0===r.value){e.next=23;break}if(!t.test(r.value)){e.next=8;break}window.alert("Sharing Phone Numbers through Chat is not allowed"),e.next=23;break;case 8:return e.next=10,(0,b.r7)((0,b.JU)(w.db,"chat",D.split("_")[1]+"_"+R+"_"+D.split("_")[0]),{conversation:(0,b.vr)({msg:r.value,time:Date.now(),type:"TEXT",user:R})});case 10:return e.sent,i={headers:{Authorization:"Bearer ".concat(n)}},e.prev=12,e.next=15,x().post(m.JW+"/messages",{id:D.split("_")[0],expertEmail:D.split("_")[1]},i);case 15:c=e.sent,c.data.success&&(r.value=""),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(12),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[12,20]])}))),children:(0,i.jsx)(c.mr,{})})})]})]})]})})]})]})},v=function(){var e;return S&&0!==S.length&&r&&0!==r.length&&_&&(e=r.filter((function(e){return S[_].id===e.id}))),(0,i.jsxs)(o.u_,{size:"4xl",onClose:H.onClose,isOpen:H.isOpen,onOpen:H.onOpen,isCentered:!0,children:[(0,i.jsx)(o.ZA,{}),(0,i.jsxs)(o.hz,{children:[(0,i.jsx)(o.xB,{children:"Confirmation Messages"}),(0,i.jsx)("hr",{}),(0,i.jsx)(o.ol,{}),(0,i.jsxs)(o.fe,{children:[(0,i.jsx)(a.X6,{size:"lg",children:e&&e[0].id}),(0,i.jsx)("hr",{}),(0,i.jsxs)(u.iA,{variant:"simple",size:"sm",children:[(0,i.jsx)(u.hr,{bgColor:"gray.200",children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Expert Email"}),(0,i.jsx)(u.Th,{children:"Messages"}),(0,i.jsx)(u.Th,{})]})}),(0,i.jsx)(u.p3,{children:e&&e[0].experts&&0===e[0].experts.length?(0,i.jsx)(i.Fragment,{}):e&&e[0].experts&&e[0].experts.map((function(n,t){return(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Td,{children:n.expertEmail}),(0,i.jsx)(u.Td,{children:n.expertChat[n.expertChat.length-1].msg}),(0,i.jsx)(u.Td,{children:(0,i.jsx)(a.Ug,{children:(0,i.jsx)(d.zx,{onClick:y(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V(e[0].id,n.expertEmail);case 2:ee(e[0].id,n.expertEmail);case 3:case"end":return t.stop()}}),t)}))),children:"Reply"})})})]},n.time)}))})]})]})]})]})},T=(0,f.useState)([]),S=T[0],E=T[1],O=(0,f.useState)(),_=O[0],I=O[1],A=(0,f.useState)(null),D=A[0],W=A[1],z=(0,f.useState)(""),R=z[0],M=z[1],P=(0,f.useState)(""),U=P[0],B=P[1],F=(0,f.useRef)(null),J=(0,h.qY)(),X=J.onOpen,q=J.onClose,H=(0,h.qY)(),N=(0,h.qY)(),L=[],Q=(0,g.useRouter)();function Y(){return Z.apply(this,arguments)}function Z(){return(Z=y(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("userEmail"),M(n),e.prev=2,e.next=5,x().get(m.JW+"/util/sas-token?container_name=assignment-dscp");case 5:t=e.sent,(r=t.data).success&&B(r.SASToken),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function K(){return G.apply(this,arguments)}function G(){return(G=y(s().mark((function e(){var n,t,r,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==(n=localStorage.getItem("userToken"))&&Q.replace("/admin/login"),t={headers:{Authorization:"Bearer ".concat(n)}},e.next=6,x().get(m.JW+"/assignment/fetch?status=Expert%20Asked",t);case 6:if(r=e.sent,i=r.data.assignmentData,L=[],0!==i.length)for(c=0;c<i.length;c++)L.push({id:i[c]._id,client_id:i[c].client_id,subject:i[c].subject,status:i[c].status,quotation:i[c].quotation,currencyOfQuote:i[c].currencyOfQuote,level:i[c].level,reference:i[c].reference,description:i[c].description,descriptionFile:i[c].descriptionFile,numOfPages:i[c].numOfPages,paid:i[c].paid,deadline:new Date(i[c].deadline).toLocaleTimeString()+", "+new Date(i[c].deadline).toDateString(),expertDeadline:new Date(i[c].expertDeadline).toLocaleTimeString()+", "+new Date(i[c].expertDeadline).toDateString()});else console.log("No Expert Asked Orders");E(L),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function V(e,n){return $.apply(this,arguments)}function $(){return($=y(s().mark((function e(n,t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n+"_"+t;try{null==localStorage.getItem("userToken")&&Q.replace("/admin/login")}catch(s){console.log(s)}W(r),N.onOpen();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,n){return ne.apply(this,arguments)}function ne(){return(ne=y(s().mark((function e(n,r){var i,c,o,a,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n+"_"+r,e.prev=1,null==(c=localStorage.getItem("userToken"))&&Q.replace("/admin/login"),{headers:{Authorization:"Bearer ".concat(c)}},!t[i]){e.next=12;break}return o=t[i].slice(),a=o.pop(),l=localStorage.getItem("userEmail"),e.next=11,(0,b.r7)((0,b.JU)(w.db,"chat",a.user+"_"+l+"_"+i.split("_")[0]),{conversation:C(o).concat([k({},a,{newMessageCount:0})])});case 11:e.sent;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function te(e){return re.apply(this,arguments)}function re(){return(re=y(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(n),H.onOpen();case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,f.useEffect)((function(){y(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y();case 2:case"end":return e.stop()}}),e)})))()}),[]),(0,f.useEffect)((function(){K()}),[]),r&&0!==r.length&&(n=r.map((function(e){var n=e.experts.reduce((function(e,n){return e+n.expertChat[n.expertChat.length-1].newMessageCount}),0);return{id:e.id,newMsgCount:n}}))),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v,{}),(0,i.jsx)(p,{}),(0,i.jsxs)(u.iA,{variant:"simple",size:"md",display:{base:"none",sm:"block",md:"block"},children:[(0,i.jsx)(u.hr,{bgColor:"gray.200",children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Id"}),(0,i.jsx)(u.Th,{children:"Student Email"}),(0,i.jsx)(u.Th,{children:"Subject"}),(0,i.jsx)(u.Th,{children:"Amount Paid"}),(0,i.jsx)(u.Th,{children:"Expert Deadline"}),(0,i.jsx)(u.Th,{children:"Deadline"}),(0,i.jsx)(u.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(c.ny,{}),onClick:y(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})]})}),(0,i.jsx)(u.p3,{children:S.map((function(e,t){return(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Td,{fontWeight:"semibold",paddingTop:9,children:(0,i.jsxs)(a.xu,{display:"flex",children:[(0,i.jsx)(a.rU,{href:"/admin/assignment_details/"+e.id,children:e.id}),n&&0!==n.length&&n.map((function(n){if(n.id===e.id&&n.newMsgCount&&0!==n.newMsgCount)return(0,i.jsxs)(a.xu,{display:"flex",alignItems:"center",position:"relative",marginLeft:2,cursor:"pointer",onClick:y(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",te(t));case 1:case"end":return e.stop()}}),e)}))),children:[(0,i.jsx)(c.kB,{width:"1.5em",height:"1.5em"}),(0,i.jsx)(a.xu,{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:15,backgroundColor:"rgb(201, 105, 105)",marginLeft:2,width:5,height:5,color:"white",position:"absolute",right:"-10px",top:"-5px",children:n.newMsgCount})]})}))]})}),(0,i.jsx)(u.Td,{children:"Super Admin"===localStorage.getItem("userRole")||"Admin"===localStorage.getItem("userRole")?e.client_id:e.client_id.substring(0,2)+"****@****.com"}),(0,i.jsx)(u.Td,{color:"green.600",fontWeight:"semibold",children:e.subject}),(0,i.jsx)(u.Td,{children:e.paid}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline})]},e.id)}))})]}),(0,i.jsx)("div",{className:"ShowSideClick",children:S.map((function(e){return(0,i.jsx)(j.UQ,{defaultIndex:[0],allowMultiple:!0,display:{base:"block",sm:"none",md:"none"},children:(0,i.jsxs)(j.Qd,{children:[(0,i.jsx)("h2",{children:(0,i.jsxs)(j.KF,{children:[(0,i.jsx)(a.xu,{flex:"1",textAlign:"left",children:(0,i.jsx)(u.iA,{children:(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Id"}),(0,i.jsx)(u.Td,{fontWeight:"semibold",children:(0,i.jsx)(a.rU,{href:"/admin/assignment_details/"+e.id,children:e.id})})]})})}),(0,i.jsx)(j.XE,{})]})}),(0,i.jsx)(j.Hk,{pb:0,children:(0,i.jsx)(u.iA,{variant:"simple",size:"md",children:(0,i.jsx)(u.p3,{children:(0,i.jsx)(u.Tr,{children:(0,i.jsxs)(u.iA,{bgColor:"gray.100",children:[(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Student Email"}),(0,i.jsx)(u.Td,{children:"Super Admin"===localStorage.getItem("userRole")||"Admin"===localStorage.getItem("userRole")?e.client_id:e.client_id.substring(0,2)+"****@****.com"})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Subject"}),(0,i.jsx)(u.Td,{color:"green.600",fontWeight:"semibold",children:e.subject})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Amount Paid"}),(0,i.jsx)(u.Td,{children:e.paid})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Expert Deadline"}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.expertDeadline})]}),(0,i.jsxs)(u.Tr,{children:[(0,i.jsx)(u.Th,{children:"Deadline"}),(0,i.jsx)(u.Td,{color:"red.600",fontWeight:"semibold",children:e.deadline})]}),(0,i.jsx)(u.Tr,{children:(0,i.jsx)(u.Th,{children:(0,i.jsx)(d.zx,{leftIcon:(0,i.jsx)(c.ny,{}),onClick:y(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:case"end":return e.stop()}}),e)}))),children:"Refresh"})})})]})},e.id)})})})]})})}))})]})}}}]);