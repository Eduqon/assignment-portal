(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2986],{9384:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/InProcessOrderMessage",function(){return t(6372)}])},6372:function(e,n,t){"use strict";t.r(n);var r=t(8520),s=t.n(r),a=t(5893),o=t(7375),i=t(2028),c=t(8790),l=t(4612),u=t(5193),p=t(9609),d=t(6257),h=t(1163),x=t(7294),f=t(9669),g=t.n(f),m=t(7388),b=t(8756),j=t(9736);function w(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function v(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function o(e){w(a,r,s,o,i,"next",e)}function i(e){w(a,r,s,o,i,"throw",e)}o(void 0)}))}}function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){y(e,n,t[n])}))}return e}function k(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.default=function(e){var n=e.assignedExpertMessages,t=e.operatorExpertChat,r=e.loading,f=e.inProcessOrderData,w=function(e){var n=e.assignment,r=e.assignmentID,p=e.openModalId,h=(0,o.qY)();return(0,x.useEffect)((function(){r===p?h.onOpen():h.onClose()}),[r,p]),(0,a.jsxs)(i.u_,{size:"lg",onClose:h.onClose,isOpen:h.isOpen,onOpen:h.onOpen,isCentered:!0,children:[(0,a.jsx)(i.ZA,{}),(0,a.jsxs)(i.hz,{maxH:"500px",children:[(0,a.jsx)(i.ol,{}),(0,a.jsx)(i.fe,{children:(0,a.jsxs)(c.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"md",children:[(0,a.jsx)(c.xu,{p:4,bgColor:"gray.200",children:(0,a.jsx)(c.Ug,{children:(0,a.jsx)(c.X6,{fontSize:"xl",children:"Operator Chat with Expert"})})}),(0,a.jsxs)(c.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"sm",maxH:"sm",children:[(0,a.jsx)(c.gC,{overflowY:"scroll",alignItems:"start",width:"100%",children:t[r]&&t[r].map((function(e,n){return(0,a.jsx)(c.xu,{display:"TEXT"===e.type||"MEDIA"===e.type?"flex":"none",alignSelf:e.user===E?"flex-end":"flex-start",flexWrap:!0,padding:2,borderRadius:"md",maxWidth:"70%",bgColor:e.user===E?"blue.100":"green.100",children:(0,a.jsxs)(c.gC,{maxWidth:"100%",overflowWrap:"break-word",children:[(0,a.jsx)(c.xv,{display:"TEXT"===e.type?"flex":"none",maxWidth:"100%",children:e.msg}),(0,a.jsx)(c.rU,{color:"blue",fontWeight:"bold",display:"MEDIA"===e.type?"flex":"none",maxWidth:"100%",href:e.msg,children:e.msg&&e.msg.substring(62)})]})},n)}))}),(0,a.jsxs)(l.BZ,{children:[(0,a.jsx)(l.II,{type:"text",id:"addChatOperatorExpert"}),(0,a.jsx)(l.II,{type:"file",id:"addFileOperatorExpert",onChange:v(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",O){z();try{r={method:"put",url:"https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(O.current.files[0].name)+"?"+A,headers:{"x-ms-blob-type":"BlockBlob"},data:O.current.files[0]},g()(r).then(function(e){var r=v(s().mark((function e(r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(O.current.files[0].name),e.next=3,(0,d.r7)((0,d.JU)(m.db,"chat",n.chat[n.chat.length-1].user+"_"+E+"_"+n.id),{conversation:(0,d.vr)({msg:t,time:Date.now(),type:"MEDIA",user:E})});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return r.apply(this,arguments)}}()).catch((function(e){console.log(e)}))}catch(a){console.log(a)}B()}case 2:case"end":return e.stop()}}),e)}))),ref:O,style:{display:"none"}}),(0,a.jsx)(l.Z8,{h:"full",children:(0,a.jsx)(u.zx,{id:"attachButton",onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:O.current.click();case 1:case"end":return e.stop()}}),e)}))),children:(0,a.jsx)(j.Uj,{})})}),(0,a.jsx)(l.xH,{h:"full",children:(0,a.jsx)(u.zx,{id:"sendButton",onClick:v(s().mark((function e(){var t,a,o,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("userToken"),a=/\b[\+]?[(]?[0-9]{2,6}[)]?[-\s\.]?[-\s\/\.0-9]{3,15}\b/m,""===(o=document.getElementById("addChatOperatorExpert")).value||void 0===o.value){e.next=23;break}if(!a.test(o.value)){e.next=8;break}window.alert("Sharing Phone Numbers through Chat is not allowed"),e.next=23;break;case 8:return e.next=10,(0,d.r7)((0,d.JU)(m.db,"chat",n.chat[n.chat.length-1].user+"_"+E+"_"+r.split("_")[0]),{conversation:(0,d.vr)({msg:o.value,time:Date.now(),type:"TEXT",user:E})});case 10:return e.sent,i={headers:{Authorization:"Bearer ".concat(t)}},e.prev=12,e.next=15,g().post(b.JW+"/messages",{id:r,expertEmail:n.assignedExpert},i);case 15:c=e.sent,c.data.success&&(o.value=""),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(12),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[12,20]])}))),children:(0,a.jsx)(j.mr,{})})})]})]})]})})]})]})},y=(0,h.useRouter)(),I=(0,x.useState)(""),E=I[0],_=I[1],O=(0,x.useRef)(null),S=(0,x.useState)(""),A=S[0],T=S[1],D=(0,x.useState)(null),P=D[0],M=D[1],W=(0,o.qY)(),z=W.onOpen,B=W.onClose;function U(){return R.apply(this,arguments)}function R(){return(R=v(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("userEmail"),_(n),e.prev=2,e.next=5,g().get(b.JW+"/util/sas-token?container_name=assignment-dscp");case 5:t=e.sent,(r=t.data).success&&T(r.SASToken),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function X(e,n){return N.apply(this,arguments)}function N(){return(N=v(s().mark((function e(n,t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.id+"_"+t.expertEmail;try{null==localStorage.getItem("userToken")&&y.replace("/admin/login")}catch(s){console.log(s)}M(r);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,n){return J.apply(this,arguments)}function J(){return(J=v(s().mark((function e(n,r){var a,o,i,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n+"_"+r.expertEmail,e.prev=1,null==(o=localStorage.getItem("userToken"))&&y.replace("/admin/login"),{headers:{Authorization:"Bearer ".concat(o)}},!t[a]){e.next=12;break}return i=t[a].slice(),c=i.pop(),l=localStorage.getItem("userEmail"),e.next=11,(0,d.r7)((0,d.JU)(m.db,"chat",c.user+"_"+l+"_"+a.split("_")[0]),{conversation:k(i).concat([C({},c,{newMessageCount:0})])});case 11:e.sent;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}return(0,x.useEffect)((function(){v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:case"end":return e.stop()}}),e)})))()}),[]),(0,a.jsxs)(a.Fragment,{children:[n&&n.map((function(e){return(0,a.jsx)(w,{assignment:e,assignmentID:e.id,openModalId:P})})),(0,a.jsxs)(c.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"lg",height:"3xl",marginTop:"20px",overflow:"hidden",children:[(0,a.jsxs)(c.xu,{p:4,bgColor:"gray.200",children:[(0,a.jsxs)(c.Ug,{children:[(0,a.jsx)(c.X6,{fontSize:"xl",children:" In-Process Orders "})," "]})," "]})," ",(0,a.jsx)(c.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"2xl",maxH:"2xl",overflowY:"scroll",children:(0,a.jsx)(c.gC,{alignItems:"start",width:"100%",children:r?(0,a.jsx)(p.$,{}):f&&f.map((function(e){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.xu,{children:[(0,a.jsxs)(c.Ug,{children:[(0,a.jsxs)(c.X6,{fontSize:"xl",children:[" ",(0,a.jsx)("a",{href:"/admin/assignment_details/"+e.id,target:"_blank",children:e.id})," "]})," "]})," "]}),e.experts&&e.experts.map((function(n){return(0,a.jsxs)(c.xu,{bgColor:"blackAlpha.100",width:"100%",p:2,children:[(0,a.jsxs)(c.xu,{display:"flex",justifyContent:"space-between",children:[(0,a.jsxs)(c.xu,{display:"flex",children:[(0,a.jsxs)("strong",{children:["By: ",n.expertEmail]}),"\xa0",0!==n.expertChat.length&&0!==n.expertChat[n.expertChat.length-1].newMessageCount&&(0,a.jsx)("div",{className:"text-center",style:{width:"25px",height:"25px",borderRadius:"5px",background:"#c96969",cursor:"pointer",margin:"2px 5px",color:"#fff",fontWeight:"bold"},children:0!==n.expertChat[n.expertChat.length-1].newMessageCount&&n.expertChat[n.expertChat.length-1].newMessageCount})]}),(0,a.jsx)(c.xu,{children:(0,a.jsx)("span",{children:n.date})})]}),(0,a.jsxs)(c.xu,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsxs)("strong",{children:["Message:"," ",0!==n.expertChat.length&&n.expertChat[n.expertChat.length-1].msg]}),(0,a.jsx)(u.zx,{onClick:v(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X(e,n);case 2:H(e.id,n);case 3:case"end":return t.stop()}}),t)}))),children:"Reply"})]})]})}))]})}))})})]})," "]})}},7388:function(e,n,t){"use strict";t.d(n,{db:function(){return o}});t(8520);var r=t(5503),s=t(6257);var a=(0,r.ZF)({apiKey:"AIzaSyDni_CDXk80T4e4DbmAdxPejk6K8gl1_BE",authDomain:"assignment-santa.firebaseapp.com",projectId:"assignment-santa",storageBucket:"assignment-santa.appspot.com",messagingSenderId:"697591868119",appId:"1:697591868119:web:ab0da28fc783e036ab1e92"}),o=(0,s.ad)(a)}},function(e){e.O(0,[2016,9669,8527,7496,1716,3673,4612,9002,9774,2888,179],(function(){return n=9384,e(e.s=n);var n}));var n=e.O();_N_E=n}]);