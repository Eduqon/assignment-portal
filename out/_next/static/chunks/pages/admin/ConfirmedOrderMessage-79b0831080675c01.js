(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3379],{9845:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/ConfirmedOrderMessage",function(){return t(2166)}])},2166:function(e,n,t){"use strict";t.r(n);var r=t(8520),s=t.n(r),a=t(5893),o=t(7375),i=t(2028),c=t(8790),l=t(4612),u=t(5193),d=t(9609),p=t(6257),h=t(1163),f=t(7294),x=t(9669),g=t.n(x),m=t(7388),b=t(8756),w=t(9736);function j(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function v(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function o(e){j(a,r,s,o,i,"next",e)}function i(e){j(a,r,s,o,i,"throw",e)}o(void 0)}))}}function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function k(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){y(e,n,t[n])}))}return e}function C(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.default=function(e){var n=e.assignedExpertMessages,t=e.operatorExpertChat,r=e.loading,x=function(e){var n=e.assignment,r=e.assignmentID,d=e.openModalId,h=(0,o.qY)();return(0,f.useEffect)((function(){r===d?h.onOpen():h.onClose()}),[r,d]),(0,a.jsxs)(i.u_,{size:"lg",onClose:h.onClose,isOpen:h.isOpen,onOpen:h.onOpen,isCentered:!0,children:[(0,a.jsx)(i.ZA,{}),(0,a.jsxs)(i.hz,{maxH:"500px",children:[(0,a.jsx)(i.ol,{}),(0,a.jsx)(i.fe,{children:(0,a.jsxs)(c.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"md",children:[(0,a.jsx)(c.xu,{p:4,bgColor:"gray.200",children:(0,a.jsx)(c.Ug,{children:(0,a.jsx)(c.X6,{fontSize:"xl",children:"Operator Chat with Expert"})})}),(0,a.jsxs)(c.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"sm",maxH:"sm",children:[(0,a.jsx)(c.gC,{overflowY:"scroll",alignItems:"start",width:"100%",children:t[r]&&t[r].map((function(e,n){return(0,a.jsx)(c.xu,{display:"TEXT"===e.type||"MEDIA"===e.type?"flex":"none",alignSelf:e.user===I?"flex-end":"flex-start",flexWrap:!0,padding:2,borderRadius:"md",maxWidth:"70%",bgColor:e.user===I?"blue.100":"green.100",children:(0,a.jsxs)(c.gC,{maxWidth:"100%",overflowWrap:"break-word",children:[(0,a.jsx)(c.xv,{display:"TEXT"===e.type?"flex":"none",maxWidth:"100%",children:e.msg}),(0,a.jsx)(c.rU,{color:"blue",fontWeight:"bold",display:"MEDIA"===e.type?"flex":"none",maxWidth:"100%",href:e.msg,children:e.msg&&e.msg.substring(62)})]})},n)}))}),(0,a.jsxs)(l.BZ,{children:[(0,a.jsx)(l.II,{type:"text",id:"addChatOperatorExpert"}),(0,a.jsx)(l.II,{type:"file",id:"addFileOperatorExpert",onChange:v(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",_){z();try{r={method:"put",url:"https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(_.current.files[0].name)+"?"+S,headers:{"x-ms-blob-type":"BlockBlob"},data:_.current.files[0]},g()(r).then(function(e){var r=v(s().mark((function e(r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://assignmentsanta.blob.core.windows.net/assignment-dscp/"+encodeURIComponent(_.current.files[0].name),e.next=3,(0,p.r7)((0,p.JU)(m.db,"chat",n.chat[n.chat.length-1].user+"_"+I+"_"+n.id),{conversation:(0,p.vr)({msg:t,time:Date.now(),type:"MEDIA",user:I})});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return r.apply(this,arguments)}}()).catch((function(e){console.log(e)}))}catch(a){console.log(a)}B()}case 2:case"end":return e.stop()}}),e)}))),ref:_,style:{display:"none"}}),(0,a.jsx)(l.Z8,{h:"full",children:(0,a.jsx)(u.zx,{id:"attachButton",onClick:v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.current.click();case 1:case"end":return e.stop()}}),e)}))),children:(0,a.jsx)(w.Uj,{})})}),(0,a.jsx)(l.xH,{h:"full",children:(0,a.jsx)(u.zx,{id:"sendButton",onClick:v(s().mark((function e(){var t,a,o,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("userToken"),a=/\b[\+]?[(]?[0-9]{2,6}[)]?[-\s\.]?[-\s\/\.0-9]{3,15}\b/m,""===(o=document.getElementById("addChatOperatorExpert")).value||void 0===o.value){e.next=23;break}if(!a.test(o.value)){e.next=8;break}window.alert("Sharing Phone Numbers through Chat is not allowed"),e.next=23;break;case 8:return e.next=10,(0,p.r7)((0,p.JU)(m.db,"chat",n.chat[n.chat.length-1].user+"_"+I+"_"+r),{conversation:(0,p.vr)({msg:o.value,time:Date.now(),type:"TEXT",user:I})});case 10:return e.sent,i={headers:{Authorization:"Bearer ".concat(t)}},e.prev=12,e.next=15,g().post(b.JW+"/messages",{id:r,expertEmail:n.assignedExpert},i);case 15:c=e.sent,c.data.success&&(o.value=""),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(12),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[12,20]])}))),children:(0,a.jsx)(w.mr,{})})})]})]})]})})]})]})},j=(0,h.useRouter)(),y=(0,f.useState)(""),I=y[0],E=y[1],_=(0,f.useRef)(null),O=(0,f.useState)(""),S=O[0],A=O[1],T=(0,f.useState)(null),D=T[0],M=T[1],W=(0,o.qY)(),z=W.onOpen,B=W.onClose;function P(){return R.apply(this,arguments)}function R(){return(R=v(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("userEmail"),E(n),e.prev=2,e.next=5,g().get(b.JW+"/util/sas-token?container_name=assignment-dscp");case 5:t=e.sent,(r=t.data).success&&A(r.SASToken),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function U(e){return X.apply(this,arguments)}function X(){return(X=v(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{null==localStorage.getItem("userToken")&&j.replace("/admin/login")}catch(t){console.log(t)}M(n.id);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return H.apply(this,arguments)}function H(){return(H=v(s().mark((function e(n){var r,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==(r=localStorage.getItem("userToken"))&&j.replace("/admin/login"),{headers:{Authorization:"Bearer ".concat(r)}},!t[n]){e.next=11;break}return a=t[n].slice(),o=a.pop(),i=localStorage.getItem("userEmail"),e.next=10,(0,p.r7)((0,p.JU)(m.db,"chat",o.user+"_"+i+"_"+n),{conversation:C(a).concat([k({},o,{newMessageCount:0})])});case 10:e.sent;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}return(0,f.useEffect)((function(){v(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:case"end":return e.stop()}}),e)})))()}),[]),(0,a.jsxs)(a.Fragment,{children:[n&&n.filter((function(e){return 0!==e.chat.length})).map((function(e){return(0,a.jsx)(x,{assignment:e,assignmentID:e.id,openModalId:D})})),(0,a.jsxs)(c.xu,{display:"block",borderWidth:"1px",borderRadius:"md",width:"lg",height:"3xl",marginTop:"20px",overflow:"hidden",children:[(0,a.jsxs)(c.xu,{p:4,bgColor:"gray.200",children:[(0,a.jsxs)(c.Ug,{children:[(0,a.jsx)(c.X6,{fontSize:"xl",children:" Confirmed Orders "})," "]})," "]})," ",(0,a.jsx)(c.gC,{alignItems:"start",justifyContent:"space-between",margin:3,minH:"2xl",maxH:"2xl",overflowY:"scroll",children:(0,a.jsx)(c.gC,{alignItems:"start",width:"100%",children:r?(0,a.jsx)(d.$,{}):n&&n.filter((function(e){return 0!==e.chat.length})).map((function(e){return(0,a.jsxs)(c.xu,{bgColor:"blackAlpha.100",width:"100%",p:2,children:[(0,a.jsxs)(c.xu,{display:"flex",justifyContent:"space-between",children:[(0,a.jsxs)(c.xu,{display:"flex",children:[(0,a.jsx)("a",{href:"/admin/assignment_details/"+e.id,target:"_blank",children:e.id}),"\xa0",0!==e.chat.length&&0!==e.chat[e.chat.length-1].newMessageCount&&(0,a.jsx)("div",{className:"text-center",style:{width:"25px",height:"25px",borderRadius:"5px",background:"#c96969",cursor:"pointer",margin:"2px 5px",color:"#fff",fontWeight:"bold"},children:0!==e.chat[e.chat.length-1].newMessageCount&&e.chat[e.chat.length-1].newMessageCount})]}),(0,a.jsx)(c.xu,{children:(0,a.jsx)("span",{children:e.date})})]}),(0,a.jsxs)(c.xu,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,a.jsxs)("strong",{children:["Message:"," ",0!==e.chat.length&&e.chat[e.chat.length-1].msg]}),(0,a.jsx)(u.zx,{onClick:v(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,U(e);case 2:N(e.id.split("_")[0]);case 3:case"end":return n.stop()}}),n)}))),children:"Reply"})]})]})}))})})]})," "]})}},7388:function(e,n,t){"use strict";t.d(n,{db:function(){return o}});t(8520);var r=t(5503),s=t(6257);var a=(0,r.ZF)({apiKey:"AIzaSyDni_CDXk80T4e4DbmAdxPejk6K8gl1_BE",authDomain:"assignment-santa.firebaseapp.com",projectId:"assignment-santa",storageBucket:"assignment-santa.appspot.com",messagingSenderId:"697591868119",appId:"1:697591868119:web:ab0da28fc783e036ab1e92"}),o=(0,s.ad)(a)}},function(e){e.O(0,[2016,9669,8527,7496,1716,3673,4612,9002,9774,2888,179],(function(){return n=9845,e(e.s=n);var n}));var n=e.O();_N_E=n}]);