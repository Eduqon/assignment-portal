"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5279],{5279:function(e,n,r){r.r(n),r.d(n,{default:function(){return b}});var t=r(5893),s=r(9042),i=r(4090),a=r(8790),c=r(7294),d=r(6257),o=r(7388),l=r(8520),x=r.n(l),h=r(9736),u=r(3181),p=r(5193),f=r(4612);function j(e,n,r,t,s,i,a){try{var c=e[i](a),d=c.value}catch(o){return void r(o)}c.done?n(d):Promise.resolve(d).then(t,s)}function g(e){return function(){var n=this,r=arguments;return new Promise((function(t,s){var i=e.apply(n,r);function a(e){j(i,t,s,a,c,"next",e)}function c(e){j(i,t,s,a,c,"throw",e)}a(void 0)}))}}function m(e){var n=(0,c.useState)("unassigned"),r=n[0],s=n[1],i=(0,c.useState)([]),l=i[0],j=i[1],m=(0,c.useState)(""),b=m[0],v=m[1],w=(0,c.useState)(""),k=w[0],T=w[1];function y(){return I.apply(this,arguments)}function I(){return(I=g(x().mark((function n(){var r,t,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=localStorage.getItem("userEmail"),v(r),n.prev=2,n.next=5,(0,d.QT)((0,d.JU)(o.db,"anonymous_chat",e.clientId));case 5:return t=n.sent,n.next=8,(0,d.pl)((0,d.JU)(o.db,"anonymous_chat",e.clientId),{operator:r});case 8:if(n.sent,""===t.data().operator){n.next=13;break}s("assigned"),n.next=18;break;case 13:return i=e.clientId+"_"+r,n.next=16,(0,d.pl)((0,d.JU)(o.db,"chat",i),{conversation:[{msg:"Hi!! Please let us know how I can assist you today?",time:Date.now(),type:"TEXT",user:r}]});case 16:n.sent,s("assigned");case 18:(0,d.cf)((0,d.JU)(o.db,"chat",e.clientId+"_"+r),(function(e){j(e.data().conversation)})),n.next=24;break;case 21:n.prev=21,n.t0=n.catch(2),console.log(n.t0);case 24:case"end":return n.stop()}}),n,null,[[2,21]])})))).apply(this,arguments)}return(0,t.jsxs)(u.J2,{placement:"top-start",children:[(0,t.jsx)(u.xo,{children:(0,t.jsx)(p.hU,{onClick:g(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:case"end":return e.stop()}}),e)}))),colorScheme:"blue",size:"lg",icon:(0,t.jsx)(h.kB,{})})}),(0,t.jsx)(u.yk,{children:(0,t.jsxs)(a.gC,{alignItems:"start",minH:"500px",maxH:"500px",children:[(0,t.jsx)(a.xu,{p:2,bgColor:"gray.200",width:"100%",children:(0,t.jsx)(a.X6,{fontSize:"xl",children:"Chat with Lead"})}),(0,t.jsx)(a.gC,{flexGrow:1,padding:"2",width:"100%",overflowY:"scroll",children:"unassigned"===r?(0,t.jsx)(a.xu,{children:(0,t.jsx)(a.xv,{children:"Connecting to an user....."})}):l.map((function(e,n){return(0,t.jsx)(a.xu,{display:"TEXT"===e.type?"flex":"none",alignSelf:e.user===b?"flex-end":"flex-start",flexWrap:!0,padding:2,borderRadius:"md",maxWidth:"70%",bgColor:e.user===b?"blue.100":"green.100",children:(0,t.jsx)(a.gC,{maxWidth:"100%",overflowWrap:"break-word",children:(0,t.jsx)(a.xv,{maxWidth:"100%",children:e.msg})})},n)}))}),(0,t.jsxs)(f.BZ,{p:1,display:"requested"===r?"none":"flex",children:[(0,t.jsx)(f.II,{type:"text",id:"props.clientId",value:k,onChange:function(e){T(e.target.value)}}),(0,t.jsx)(f.xH,{h:"full",children:(0,t.jsx)(p.zx,{id:"sendButton",onClick:g(x().mark((function n(){return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(""===k||void 0===k){n.next=9;break}if(!/\b[\+]?[(]?[0-9]{2,6}[)]?[-\s\.]?[-\s\/\.0-9]{3,15}\b/m.test(k)){n.next=6;break}window.alert("Sending Phone Numbers through Chat is not allowed"),n.next=9;break;case 6:return n.next=8,(0,d.r7)((0,d.JU)(o.db,"chat",e.clientId+"_"+b),{conversation:(0,d.vr)({msg:k,time:Date.now(),type:"TEXT",user:b})});case 8:n.sent;case 9:T("");case 10:case"end":return n.stop()}}),n)}))),children:(0,t.jsx)(h.dt,{})})})]})]})})]})}var b=function(){var e=(0,c.useState)([]),n=e[0],r=e[1],l=(0,c.useState)(!1),x=l[0],h=l[1];return(0,c.useEffect)((function(){if(!x){var e=(0,d.IO)((0,d.hJ)(o.db,"anonymous_chat"),(0,d.Xo)("time","desc"),(0,d.ar)("time",">=",Date.now()-18e5));(0,d.cf)(e,(function(e){var n=[];e.forEach((function(e){n.push(e)})),r(n)}));h(!0)}}),[x,n]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.iA,{variant:"simple",size:"md",display:{base:"none",sm:"block",md:"block"},children:[(0,t.jsx)(s.hr,{bgColor:"gray.200",children:(0,t.jsxs)(s.Tr,{children:[(0,t.jsx)(s.Th,{children:"ID"}),(0,t.jsx)(s.Th,{children:"Assigned Sales"}),(0,t.jsx)(s.Th,{})]})}),(0,t.jsx)(s.p3,{children:0===n.length?(0,t.jsx)(t.Fragment,{}):n.map((function(e,n){return(0,t.jsxs)(s.Tr,{children:[(0,t.jsx)(s.Td,{fontWeight:"semibold",children:e.id}),(0,t.jsx)(s.Td,{children:e.data().operator}),(0,t.jsx)(s.Td,{children:(0,t.jsx)(m,{isAssignedOperator:!!e.data().operator,clientId:e.id,assignedOperator:e.data().operator})})]},e.id)}))})]}),(0,t.jsx)("div",{className:"ShowSideClick",children:0===n.length?(0,t.jsx)(t.Fragment,{}):n.map((function(e,n){return(0,t.jsx)(i.UQ,{defaultIndex:[0],allowMultiple:!0,display:{base:"block",sm:"none",md:"none"},children:(0,t.jsxs)(i.Qd,{children:[(0,t.jsx)("h2",{children:(0,t.jsxs)(i.KF,{children:[(0,t.jsx)(a.xu,{flex:"1",textAlign:"left",children:(0,t.jsx)(s.iA,{children:(0,t.jsxs)(s.Tr,{children:[(0,t.jsx)(s.Th,{children:"ID"}),(0,t.jsx)(s.Td,{fontWeight:"semibold",children:e.id})]})})}),(0,t.jsx)(i.XE,{})]})}),(0,t.jsx)(i.Hk,{pb:4,children:(0,t.jsx)(s.xJ,{children:(0,t.jsx)(s.iA,{children:(0,t.jsxs)(s.p3,{children:[(0,t.jsxs)(s.Tr,{children:[(0,t.jsx)(s.Th,{children:"ID"}),(0,t.jsx)(s.Th,{children:"Assigned Sales"})]}),(0,t.jsx)(s.Tr,{children:(0,t.jsx)(s.iA,{children:(0,t.jsx)(s.Tr,{children:(0,t.jsx)(m,{isAssignedOperator:!!e.data().operator,clientId:e.id,assignedOperator:e.data().operator})})})},e.id)]})})})})]})})}))})]})}}}]);